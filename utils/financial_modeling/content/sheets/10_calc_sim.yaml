# =============================================================================
# Sheet 10: Calc_Sim - Monte Carlo Simulation
# =============================================================================

sheet_id: "10_Calc_Sim"
title: "Monte Carlo Simulation"

context_box:
  title: "Running the Monte Carlo Simulation"
  content: |
    This sheet captures 1000 iterations using Excel's Data Table feature.

    SETUP INSTRUCTIONS:
    1. Select the data range A5:I1005 (headers + 1000 rows)
    2. Go to Data > What-If Analysis > Data Table
    3. Leave "Row input cell" blank
    4. For "Column input cell" enter: $K$1 (any blank cell on this sheet)
    5. Click OK

    HOW IT WORKS:
    - Excel recalculates the model 1000 times
    - Each row captures one iteration's outputs (NPV, scenario values, costs)
    - The Data Table forces RAND() functions to regenerate each iteration
    - Results are stored as values, not formulas

    RECALCULATING:
    - Press Ctrl+Alt+F9 to force full recalculation
    - This regenerates all 1000 iterations (may take several seconds)
    - Standard F9 only recalculates changed cells

    OUTPUT STATISTICS:
    - Expected NPV: Mean of 1000 iterations
    - P10/P50/P90: Percentile values for confidence intervals
    - Prob(NPV>0): Percentage of iterations with positive NPV

columns:
  Iteration: "Row number (1-1000)"
  NPV: "Net Present Value for this iteration"
  S1: "Season Extension value captured"
  S2: "Intervention Avoidance value captured"
  S3: "Spatial Routing value captured"
  S4: "Early Detection value captured"
  Cost: "Annual testing cost"
  Net: "Net annual benefit (Total Value - Cost)"

tables:
  simulation_data:
    table_name: "tbl_SimData"
    title: "Monte Carlo Simulation Data"
    description: "1000 iteration results from Excel Data Table Monte Carlo simulation."
    purpose: "Capture stochastic outputs for statistical analysis and risk quantification"
    assumptions: |
      - 1000 iterations provides sufficient sample size for stable statistics
      - Each iteration uses independent random draws from defined distributions
      - Data Table feature recalculates all RAND() functions per iteration
      - Results stored as values (not formulas) after Data Table execution
    data_source: "Excel Data Table Monte Carlo simulation using 5_ServiceModels distributions"
    related_tables: ["tbl_Triangular", "tbl_Beta", "tbl_KPIs"]
    headers: [Iteration, NPV, S1, S2, S3, S4, Cost, Net]
    rows: []  # Rows are generated by Excel Data Table, not YAML

  simulation_summary:
    table_name: "tbl_SimSummary"
    title: "Simulation Summary Statistics"
    description: "Key statistical measures derived from 1000 Monte Carlo iterations."
    purpose: "Provide decision-relevant statistics including expected value and risk percentiles"
    assumptions: |
      - P10/P50/P90 calculated using Excel PERCENTILE function
      - Expected value is arithmetic mean of 1000 iterations
      - Probability calculations use COUNTIF for positive outcomes
      - Statistics update when simulation is recalculated
    data_source: "Calculated from tbl_SimData Monte Carlo results"
    related_tables: ["tbl_SimData", "tbl_KPIs", "tbl_Dashboard"]
    headers: [Statistic, Value]
    rows:
      - statistic: "Expected NPV"
        value: "=AVERAGE(tbl_SimData[NPV])"
      - statistic: "P10 (Pessimistic)"
        value: "=PERCENTILE(tbl_SimData[NPV],0.1)"
      - statistic: "P50 (Median)"
        value: "=PERCENTILE(tbl_SimData[NPV],0.5)"
      - statistic: "P90 (Optimistic)"
        value: "=PERCENTILE(tbl_SimData[NPV],0.9)"
      - statistic: "Prob(NPV > 0)"
        value: "=COUNTIF(tbl_SimData[NPV],\">0\")/1000"
      - statistic: "Standard Deviation"
        value: "=STDEV(tbl_SimData[NPV])"
